/**
 * jQuery-multiAutocomplete
 * @version: v1.2.0
 * @author: Israel Moraes
 * 
 * Created by Israel Moraes on 2020-07-13. Please report any bug at https://github.com/IsraelFM/jQuery-multiAutocomplete
 *
 * Developed with UMD (Universal Module Definition) patterns for JavaScript modules that work everywhere.
 * https://github.com/umdjs/umd/blob/master/templates/jqueryPlugin.js
 */

!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports&&"function"==typeof require?module.exports=e(require("jquery")):e(jQuery)}(function(e){"use strict";const t={ALT:18,LEFT:37,UP:38,RIGHT:39,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8,SPACE:32},n={createContainer:function(e,t){let n=19.1*t,s=document.createElement("div");return s.className=e,s.style.position="absolute",s.style.display="none",s.style["max-height"]=n+"px",s.style["overflow-y"]="auto",s}};e.fn.multiAutocomplete=function(o,i){i=i||{},s=e.jPluginDefaults;return e(this).each(function(){let s=e(this).data("multiAutocomplete");if("string"!=typeof o)return s&&s.destroy(),e(this).data("multiAutocomplete",new function(s,o,i){let l={events:function(){s.on("keydown.multiAutocomplete",function(n){const o=a.class.suggestion,i=a.class.selected;if(n.keyCode===t.SPACE&&(n.metaKey||n.ctrlKey?l.createSuggestionContainers():u.hide()),n.keyCode===t.PAGEDOWN){const e=u.find(`.${i}`);e.length&&(e.removeClass(i),a.selectedIndex=e.data("index")+a.options.maxShowSuggestion,a.selectedIndex>u.children().length&&(a.selectedIndex=u.children().last().data("index")),u.children().eq(a.selectedIndex).addClass(i).get(0).scrollIntoView({block:"start"}))}if(n.keyCode===t.PAGEUP){const e=u.find(`.${i}`);e.length&&(e.removeClass(i),a.selectedIndex=e.data("index")-a.options.maxShowSuggestion,a.selectedIndex<0&&(a.selectedIndex=u.children().first().data("index")),u.children().eq(a.selectedIndex).addClass(i).get(0).scrollIntoView({block:"end"}))}if(n.keyCode===t.DOWN){const e=u.find(`.${i}`);e.next(`.${o}`).length&&(e.removeClass(i).next().addClass(i),a.selectedIndex=e.data("index"),e.next(`.${o}`).get(0).scrollIntoView({block:"nearest"}))}if(n.keyCode===t.UP){const e=u.find(`.${i}`);e.prev(`.${o}`).length&&(e.removeClass(i).prev().addClass(i),a.selectedIndex=e.data("index"),e.prev(`.${o}`).get(0).scrollIntoView({block:"nearest"}))}if(-1!==e.inArray(n.keyCode,a.options.stopSuggestionKeys)){if(u.children().length>0){let e=u.find(`.${o}.${i}`).html();l.updateSelection(l.getCompletion(e))}return s.blur(),s.focus(),!1}}).on("keyup.multiAutocomplete",function(e){const n=e.altKey||e.metaKey||e.ctrlKey;switch(e.keyCode){case t.UP:case t.DOWN:case t.PAGEDOWN:case t.PAGEUP:break;case t.LEFT:case t.RIGHT:case t.TAB:case t.BACKSPACE:case t.DEL:(u.is(":visible")||a.options.autosuggest)&&l.createSuggestionContainers();break;case t.ESC:u.hide();break;default:(u.is(":visible")||!n&&a.options.autosuggest)&&l.getChunk().length>=a.options.minChunkSize&&l.createSuggestionContainers()}}).on("blur.multiAutocomplete",function(){u.hide()}),u.on("mouseout.multiAutocomplete",function(){e("."+a.class.suggestion).removeClass(a.class.hover)}).on("mouseover.multiAutocomplete","."+a.class.suggestion,function(){e(this).addClass(a.class.hover)}).on("mousedown.multiAutocomplete","."+a.class.suggestion,function(t){let n=e(this).html();l.updateSelection(l.getCompletion(n)),l.createSuggestionContainers(),s.focus(),t.preventDefault()})},destroyEvents:function(){s.off(["keypress","keydown","keyup","blur","mouseout","mouseover","mousedown",""].join(".multiAutocomplete "))},getChunk:function(){let e,t,n=a.options.delimiters.split(""),o=s.val().substr(0,l.getInputSelection(s).start),i=-1;for(let s=0;s<n.length;s++)e=n[s],(t=o.lastIndexOf(e))>i&&(i=t);return i<0?o:o.substr(i+1)},updateSelection:function(e){let t=l.getInputSelection(s),n=t.start,o=n+e.length;if(t.elDOM.setRangeText)t.elDOM.setRangeText(e);else{let t=s.val().substring(0,n),i=s.val().substring(o,s.val().length),l=s.val().substring(n,o);s.val(t+e+l+i)}t.elDOM.setSelectionRange(o,o)},createSuggestionContainers:function(){let e,t=l.getChunk(),n="",s=0;if(a.options.prefixRegexps.test(t))for(let i=0;i<o.length;i++)e=o[i],a.options.ignoreCase&&(e=e.toLowerCase(),t=t.toLowerCase()),0===e.indexOf(t)&&(n+=`<div class="${`${a.class.suggestion} ${0===s?a.class.selected:""}`}" data-index="${s++}">${`<strong>${t}</strong>${e.substr(t.length)}`}</div>`);u.html(n),n?u.show():u.hide(),a.selectedIndex=0;const i=u.find(`.${a.class.suggestion}`);i.length&&i.get(0).scrollIntoView({block:"nearest"})},getCompletion:function(e){let t=l.getChunk();return(t+e.replace(/<[^>]*>(.*?)[^>]*>/,"")).substr(t.length)+a.options.endingSymbols},getInputSelection:function(e){let t=0,n=0;return"number"==typeof(e=e.get(0)).selectionStart&&"number"==typeof e.selectionEnd&&(t=e.selectionStart,n=e.selectionEnd),{elDOM:e,start:t,end:n}}};s=e(s);let u,a=this;a.suggestions=o,a.options=i,a.destroy=function(e){l.destroyEvents(),e.removeData("multiAutocomplete")},a.init=function(t){if(t){a.options=e.extend({},e.jPluginDefaults,i),a.selectedIndex=-1,a.class={suggestions:"multiAutocomplete-suggestions",suggestion:"multiAutocomplete-suggestion",selected:"multiAutocomplete-selected",hover:"multiAutocomplete-hover"},s.attr("autocomplete","off");let t=n.createContainer(a.class.suggestions,a.options.maxShowSuggestion);u=s.after(t).next(),l.destroyEvents(),l.events()}},a.init(s.is("input"))}(this,o,i));s&&"function"==typeof s[o]&&s[o](e(this))}),this};let s={delimiters:" ",minChunkSize:1,autosuggest:!0,endingSymbols:"",prefixRegexps:/.*/,stopSuggestionKeys:[9,13],ignoreCase:!1,maxShowSuggestion:10};e.jPluginDefaults=e.jPluginDefaults||{},s=e.jPluginDefaults=e.extend(!0,{},s,e.jPluginDefaults)});