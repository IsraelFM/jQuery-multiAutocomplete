/**
 * jQuery-multiAutocomplete
 * @version: v1.0.1
 * @author: Israel Moraes
 * 
 * Created by Israel Moraes on 2020-07-13. Please report any bug at https://github.com/IsraelFM/jQuery-multiAutocomplete
 *
 * Developed with UMD (Universal Module Definition) patterns for JavaScript modules that work everywhere.
 * https://github.com/umdjs/umd/blob/master/templates/jqueryPlugin.js
 */

!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports&&"function"==typeof require?module.exports=e(require("jquery")):e(jQuery)}(function(e){"use strict";const t={ALT:18,LEFT:37,UP:38,RIGHT:39,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8,SPACE:32},n={createContainer:function(e){let t=document.createElement("div");return t.className=e,t.style.position="absolute",t.style.display="none",t.style["max-height"]="100px",t.style["overflow-y"]="auto",t}};e.fn.multiAutocomplete=function(o,i){i=i||{},s=e.jPluginDefaults;return e(this).each(function(){if(void 0===e(this).data("multiAutocomplete"))return e(this).data("multiAutocomplete",new function(s,o,i){let l={events:function(){s.on("keydown.multiAutocomplete",function(n){if(n.keyCode===t.SPACE&&(n.metaKey||n.ctrlKey?l.createSuggestionContainers():u.hide()),n.keyCode===t.UP||n.keyCode===t.DOWN)return!1;if(-1!==e.inArray(n.keyCode,a.options.stopSuggestionKeys)){if(u.children().length>0){let e=u.find(`.${a.class.suggestion}.${a.class.selected}`).html();l.updateSelection(l.getCompletion(e))}return!1}}).on("keyup.multiAutocomplete",function(e){let n,s=e.altKey||e.metaKey||e.ctrlKey,o=a.class.suggestion,i=a.class.selected;switch(e.keyCode){case t.LEFT:case t.RIGHT:case t.TAB:case t.BACKSPACE:case t.DEL:(u.is(":visible")||a.options.autosuggest)&&l.createSuggestionContainers();break;case t.ESC:u.hide();break;case t.UP:a.selectedIndex>0&&(n=u.find(`.${o}:not(:first-child).${i}`).removeClass(i).prev().addClass(i),a.selectedIndex=n.data("index"),n.get(0).scrollIntoView({block:"nearest"}));break;case t.DOWN:a.selectedIndex<u.children().length-1&&(n=u.find(`.${o}:not(:last-child).${i}`).removeClass(i).next().addClass(i),a.selectedIndex=n.data("index"),n.get(0).scrollIntoView({block:"nearest"}));break;default:(u.is(":visible")||!s&&a.options.autosuggest)&&l.getChunk().length>=a.options.minChunkSize&&l.createSuggestionContainers()}}).on("blur.multiAutocomplete",function(){u.hide()}),u.on("mouseout.multiAutocomplete",function(){e("."+a.class.suggestion).removeClass(a.class.hover)}).on("mouseover.multiAutocomplete","."+a.class.suggestion,function(){e(this).addClass(a.class.hover)}).on("mousedown.multiAutocomplete","."+a.class.suggestion,function(t){let n=e(this).html();l.updateSelection(l.getCompletion(n)),l.createSuggestionContainers(),s.focus(),t.preventDefault()})},destroyEvents:function(){s.off(["keydown","keyup","blur","mouseout","mouseover","mousedown",""].join(".multiAutocomplete "))},getChunk:function(){let e,t,n=a.options.delimiters.split(""),o=s.val().substr(0,l.getInputSelection(s).start),i=-1;for(let s=0;s<n.length;s++)e=n[s],(t=o.lastIndexOf(e))>i&&(i=t);return i<0?o:o.substr(i+1)},updateSelection:function(e){let t=l.getInputSelection(s),n=t.start,o=n+e.length;if(t.elDOM.setRangeText)t.elDOM.setRangeText(e);else{let t=s.val().substring(0,n),i=s.val().substring(o,s.val().length),l=s.val().substring(n,o);s.val(t+e+l+i)}t.elDOM.setSelectionRange(o,o)},createSuggestionContainers:function(){let e,t=l.getChunk(),n="",s=0;if(a.options.prefixRegexps.test(t))for(let i=0;i<o.length;i++)e=o[i],a.options.ignoreCase&&(e=e.toLowerCase(),t=t.toLowerCase()),0===e.indexOf(t)&&(n+=`<div class="${`${a.class.suggestion} ${0===s?a.class.selected:""}`}" data-index="${s++}">${`<strong>${t}</strong>${e.substr(t.length)}`}</div>`);u.html(n),n?u.show():u.hide(),a.selectedIndex=0},getCompletion:function(e){let t=l.getChunk();return(t+e.replace(/<[^>]*>(.*?)[^>]*>/,"")).substr(t.length)+a.options.endingSymbols},getInputSelection:function(e){let t=0,n=0;return"number"==typeof(e=e.get(0)).selectionStart&&"number"==typeof e.selectionEnd&&(t=e.selectionStart,n=e.selectionEnd),{elDOM:e,start:t,end:n}}};s=e(s);let u,a=this;a.suggestions=o,a.options=i,a.destroy=function(){return l.destroyEvents(),s},a.init=function(t){if(t){a.options=e.extend({},e.jPluginDefaults,i),a.selectedIndex=-1,a.class={suggestions:"multiAutocomplete-suggestions",suggestion:"multiAutocomplete-suggestion",selected:"multiAutocomplete-selected",hover:"multiAutocomplete-hover"};let t=n.createContainer(a.class.suggestions);u=s.after(t).next(),l.destroyEvents(),l.events()}},a.init(s.is("input"))}(this,o,i))}),this},e.fn.destroy=function(){return this.each(function(){let t=e(this).data("multiAutocomplete");t&&t.destroy().removeData("multiAutocomplete")})};let s={delimiters:" ",minChunkSize:1,autosuggest:!0,endingSymbols:"",prefixRegexps:/.*/,stopSuggestionKeys:[9,13],ignoreCase:!1};e.jPluginDefaults=e.jPluginDefaults||{},s=e.jPluginDefaults=e.extend(!0,{},s,e.jPluginDefaults)});